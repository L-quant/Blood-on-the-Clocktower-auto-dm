<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ— è¯´ä¹¦äººæ¨¡å¼æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        h1 {
            text-align: center;
            color: #4CAF50;
        }
        .test-section {
            background: #2a2a2a;
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .test-section h2 {
            color: #4CAF50;
            margin-top: 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #45a049;
        }
        button.secondary {
            background: #2196F3;
        }
        button.secondary:hover {
            background: #0b7dda;
        }
        button.danger {
            background: #f44336;
        }
        button.danger:hover {
            background: #da190b;
        }
        .result {
            background: #333;
            border-left: 4px solid #4CAF50;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .result.error {
            border-left-color: #f44336;
        }
        .result.success {
            border-left-color: #4CAF50;
        }
        .result.info {
            border-left-color: #2196F3;
        }
        .player-windows {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        .player-window {
            background: #333;
            border: 2px solid #666;
            border-radius: 5px;
            padding: 10px;
        }
        .player-window h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            margin: 5px 0;
        }
        .status.connected {
            background: #4CAF50;
        }
        .status.disconnected {
            background: #f44336;
        }
        .status.pending {
            background: #FFC107;
            color: #000;
        }
        input {
            padding: 8px;
            margin: 5px;
            border: 1px solid #666;
            border-radius: 3px;
            background: #333;
            color: #fff;
        }
        .instructions {
            background: #1e3a5f;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #2196F3;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
        }
        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ­ æ— è¯´ä¹¦äººæ¨¡å¼æµ‹è¯•å·¥å…·</h1>
    
    <div class="instructions">
        <h3>ğŸ“‹ ä½¿ç”¨è¯´æ˜</h3>
        <ol>
            <li>ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼ˆnpm run serveï¼‰</li>
            <li>ä½¿ç”¨ä¸‹é¢çš„æµ‹è¯•æŒ‰é’®éªŒè¯å„é¡¹åŠŸèƒ½</li>
            <li>æˆ–è€…æ‰“å¼€å¤šä¸ªæµè§ˆå™¨æ ‡ç­¾é¡µè¿›è¡ŒçœŸå®æµ‹è¯•</li>
            <li>æŸ¥çœ‹æ§åˆ¶å°ï¼ˆF12ï¼‰è·å–è¯¦ç»†æ—¥å¿—</li>
        </ol>
    </div>

    <!-- æµ‹è¯•1ï¼šåŸºç¡€åŠŸèƒ½æµ‹è¯• -->
    <div class="test-section">
        <h2>1ï¸âƒ£ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
        <p>æµ‹è¯•æ¸¸æˆæ¨¡å¼åˆ‡æ¢å’Œéšç§ä¿æŠ¤æ¨¡å—æ˜¯å¦æ­£ç¡®åŠ è½½</p>
        <button onclick="testBasicFunctionality()">è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
        <button class="secondary" onclick="clearResult('basic')">æ¸…é™¤ç»“æœ</button>
        <div id="basic-result" class="result"></div>
    </div>

    <!-- æµ‹è¯•2ï¼šæ¨¡å¼åˆ‡æ¢æµ‹è¯• -->
    <div class="test-section">
        <h2>2ï¸âƒ£ æ¨¡å¼åˆ‡æ¢æµ‹è¯•</h2>
        <p>æµ‹è¯•åœ¨è¯´ä¹¦äººæ¨¡å¼å’Œæ— è¯´ä¹¦äººæ¨¡å¼ä¹‹é—´åˆ‡æ¢</p>
        <button onclick="testModeSwitching()">æµ‹è¯•æ¨¡å¼åˆ‡æ¢</button>
        <button class="secondary" onclick="getCurrentMode()">æŸ¥çœ‹å½“å‰æ¨¡å¼</button>
        <button class="secondary" onclick="clearResult('mode')">æ¸…é™¤ç»“æœ</button>
        <div id="mode-result" class="result"></div>
    </div>

    <!-- æµ‹è¯•3ï¼šåº§ä½è®¤é¢†æµ‹è¯• -->
    <div class="test-section">
        <h2>3ï¸âƒ£ åº§ä½è®¤é¢†æµ‹è¯•</h2>
        <p>æµ‹è¯•ç©å®¶åº§ä½è®¤é¢†å’Œä»¤ç‰Œç”Ÿæˆ</p>
        <div>
            <input type="text" id="player-id" placeholder="ç©å®¶ID (ä¾‹å¦‚: player1)" value="player1">
            <input type="number" id="seat-index" placeholder="åº§ä½ç´¢å¼• (0-19)" value="0" min="0" max="19">
        </div>
        <button onclick="testClaimSeat()">è®¤é¢†åº§ä½</button>
        <button class="secondary" onclick="testReleaseSeat()">é‡Šæ”¾åº§ä½</button>
        <button class="secondary" onclick="getAvailableSeats()">æŸ¥çœ‹å¯ç”¨åº§ä½</button>
        <button class="secondary" onclick="clearResult('seat')">æ¸…é™¤ç»“æœ</button>
        <div id="seat-result" class="result"></div>
    </div>

    <!-- æµ‹è¯•4ï¼šå¤šç©å®¶æ¨¡æ‹Ÿ -->
    <div class="test-section">
        <h2>4ï¸âƒ£ å¤šç©å®¶æ¨¡æ‹Ÿæµ‹è¯•</h2>
        <p>åœ¨å•ä¸ªé¡µé¢ä¸­æ¨¡æ‹Ÿå¤šä¸ªç©å®¶</p>
        <button onclick="openMultipleWindows()">æ‰“å¼€å¤šä¸ªæµ‹è¯•çª—å£</button>
        <button class="secondary" onclick="simulateMultiplePlayers()">æ¨¡æ‹Ÿ3ä¸ªç©å®¶</button>
        <button class="danger" onclick="clearAllPlayers()">æ¸…é™¤æ‰€æœ‰ç©å®¶</button>
        <button class="secondary" onclick="clearResult('multi')">æ¸…é™¤ç»“æœ</button>
        <div id="multi-result" class="result"></div>
    </div>

    <!-- æµ‹è¯•5ï¼šéšç§ä¿æŠ¤éªŒè¯ -->
    <div class="test-section">
        <h2>5ï¸âƒ£ éšç§ä¿æŠ¤éªŒè¯</h2>
        <p>éªŒè¯è§’è‰²ä¿¡æ¯æ˜¯å¦æ­£ç¡®éšè—</p>
        <button onclick="testPrivacyProtection()">æµ‹è¯•éšç§ä¿æŠ¤</button>
        <button class="secondary" onclick="testRoleVisibility()">æµ‹è¯•è§’è‰²å¯è§æ€§</button>
        <button class="secondary" onclick="clearResult('privacy')">æ¸…é™¤ç»“æœ</button>
        <div id="privacy-result" class="result"></div>
    </div>

    <!-- å¿«é€Ÿæ“ä½œ -->
    <div class="test-section">
        <h2>âš¡ å¿«é€Ÿæ“ä½œ</h2>
        <button onclick="openMainApp()">æ‰“å¼€ä¸»åº”ç”¨</button>
        <button class="secondary" onclick="openConsole()">æ‰“å¼€æ§åˆ¶å°è¯´æ˜</button>
        <button class="secondary" onclick="copyTestURL()">å¤åˆ¶æµ‹è¯•URL</button>
        <button class="danger" onclick="resetAllTests()">é‡ç½®æ‰€æœ‰æµ‹è¯•</button>
    </div>

    <script>
        // å·¥å…·å‡½æ•°
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId + '-result');
            if (element) {
                const timestamp = new Date().toLocaleTimeString();
                element.className = 'result ' + type;
                element.textContent += `[${timestamp}] ${message}\n`;
                element.scrollTop = element.scrollHeight;
            }
            console.log(`[${type.toUpperCase()}]`, message);
        }

        function clearResult(elementId) {
            const element = document.getElementById(elementId + '-result');
            if (element) {
                element.textContent = '';
            }
        }

        // æµ‹è¯•1ï¼šåŸºç¡€åŠŸèƒ½æµ‹è¯•
        function testBasicFunctionality() {
            log('basic', 'å¼€å§‹åŸºç¡€åŠŸèƒ½æµ‹è¯•...', 'info');
            
            // æ£€æŸ¥æ˜¯å¦å¯ä»¥è®¿é—®ä¸»åº”ç”¨
            const mainAppURL = 'http://localhost:8081/';
            log('basic', `ä¸»åº”ç”¨URL: ${mainAppURL}`, 'info');
            
            // æç¤ºç”¨æˆ·æ‰“å¼€ä¸»åº”ç”¨
            log('basic', 'è¯·åœ¨ä¸»åº”ç”¨ä¸­æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰', 'info');
            log('basic', 'ç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥privacyæ¨¡å—ï¼š', 'info');
            log('basic', '  this.$store.state.privacy', 'success');
            log('basic', '', 'info');
            log('basic', 'é¢„æœŸç»“æœï¼šåº”è¯¥çœ‹åˆ°åŒ…å«ä»¥ä¸‹å±æ€§çš„å¯¹è±¡ï¼š', 'info');
            log('basic', '  - gameMode: "storyteller" æˆ– "player-only"', 'success');
            log('basic', '  - isPrivacyEnabled: true/false', 'success');
            log('basic', '  - myPlayerId: null æˆ–ç©å®¶ID', 'success');
            log('basic', '', 'info');
            log('basic', 'âœ… å¦‚æœçœ‹åˆ°è¿™äº›å±æ€§ï¼Œè¯´æ˜privacyæ¨¡å—å·²æ­£ç¡®åŠ è½½', 'success');
        }

        // æµ‹è¯•2ï¼šæ¨¡å¼åˆ‡æ¢æµ‹è¯•
        function testModeSwitching() {
            log('mode', 'å¼€å§‹æ¨¡å¼åˆ‡æ¢æµ‹è¯•...', 'info');
            log('mode', '', 'info');
            log('mode', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š', 'info');
            log('mode', '', 'info');
            log('mode', '1. åˆ‡æ¢åˆ°æ— è¯´ä¹¦äººæ¨¡å¼ï¼š', 'info');
            log('mode', '   this.$store.dispatch("privacy/switchGameMode", "player-only")', 'success');
            log('mode', '', 'info');
            log('mode', '2. åˆ‡æ¢å›è¯´ä¹¦äººæ¨¡å¼ï¼š', 'info');
            log('mode', '   this.$store.dispatch("privacy/switchGameMode", "storyteller")', 'success');
            log('mode', '', 'info');
            log('mode', 'é¢„æœŸç»“æœï¼š', 'info');
            log('mode', '  - è¿”å› { success: true }', 'success');
            log('mode', '  - æ§åˆ¶å°æ˜¾ç¤º "[Privacy] Switched to xxx mode"', 'success');
        }

        function getCurrentMode() {
            log('mode', 'æŸ¥çœ‹å½“å‰æ¨¡å¼...', 'info');
            log('mode', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š', 'info');
            log('mode', '  this.$store.state.privacy.gameMode', 'success');
        }

        // æµ‹è¯•3ï¼šåº§ä½è®¤é¢†æµ‹è¯•
        function testClaimSeat() {
            const playerId = document.getElementById('player-id').value;
            const seatIndex = parseInt(document.getElementById('seat-index').value);
            
            log('seat', `æµ‹è¯•è®¤é¢†åº§ä½ - ç©å®¶: ${playerId}, åº§ä½: ${seatIndex}`, 'info');
            log('seat', '', 'info');
            log('seat', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š', 'info');
            log('seat', `  this.$store.dispatch("privacy/claimSeat", { playerId: "${playerId}", seatIndex: ${seatIndex} })`, 'success');
            log('seat', '', 'info');
            log('seat', 'é¢„æœŸç»“æœï¼š', 'info');
            log('seat', '  - è¿”å› { success: true }', 'success');
            log('seat', '  - æ§åˆ¶å°æ˜¾ç¤º "[Privacy] Successfully claimed seat X"', 'success');
        }

        function testReleaseSeat() {
            log('seat', 'æµ‹è¯•é‡Šæ”¾åº§ä½...', 'info');
            log('seat', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š', 'info');
            log('seat', '  this.$store.dispatch("privacy/releaseSeat")', 'success');
        }

        function getAvailableSeats() {
            log('seat', 'æŸ¥çœ‹å¯ç”¨åº§ä½...', 'info');
            log('seat', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š', 'info');
            log('seat', '  this.$store.getters["privacy/availableSeats"]', 'success');
        }

        // æµ‹è¯•4ï¼šå¤šç©å®¶æ¨¡æ‹Ÿ
        function openMultipleWindows() {
            log('multi', 'æ‰“å¼€å¤šä¸ªæµ‹è¯•çª—å£...', 'info');
            const baseURL = 'http://localhost:8081/';
            
            // æ‰“å¼€3ä¸ªçª—å£
            for (let i = 1; i <= 3; i++) {
                setTimeout(() => {
                    window.open(baseURL, `player${i}`, 'width=800,height=600');
                    log('multi', `å·²æ‰“å¼€çª—å£ ${i}`, 'success');
                }, i * 500);
            }
            
            log('multi', '', 'info');
            log('multi', 'æµ‹è¯•æ­¥éª¤ï¼š', 'info');
            log('multi', '1. åœ¨çª—å£1ä¸­åˆ›å»ºä¼šè¯ï¼ˆä¸»æŒï¼‰', 'info');
            log('multi', '2. åœ¨çª—å£2å’Œ3ä¸­åŠ å…¥ä¼šè¯', 'info');
            log('multi', '3. æ¯ä¸ªçª—å£è®¤é¢†ä¸åŒçš„åº§ä½', 'info');
            log('multi', '4. éªŒè¯æ¯ä¸ªçª—å£åªèƒ½çœ‹åˆ°è‡ªå·±çš„è§’è‰²', 'info');
        }

        function simulateMultiplePlayers() {
            log('multi', 'æ¨¡æ‹Ÿ3ä¸ªç©å®¶è®¤é¢†åº§ä½...', 'info');
            log('multi', '', 'info');
            log('multi', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­ä¾æ¬¡è¿è¡Œï¼š', 'info');
            log('multi', '', 'info');
            log('multi', 'ç©å®¶1è®¤é¢†åº§ä½0ï¼š', 'info');
            log('multi', '  this.$store.dispatch("privacy/claimSeat", { playerId: "Alice", seatIndex: 0 })', 'success');
            log('multi', '', 'info');
            log('multi', 'ç©å®¶2è®¤é¢†åº§ä½1ï¼š', 'info');
            log('multi', '  this.$store.dispatch("privacy/claimSeat", { playerId: "Bob", seatIndex: 1 })', 'success');
            log('multi', '', 'info');
            log('multi', 'ç©å®¶3è®¤é¢†åº§ä½2ï¼š', 'info');
            log('multi', '  this.$store.dispatch("privacy/claimSeat", { playerId: "Charlie", seatIndex: 2 })', 'success');
        }

        function clearAllPlayers() {
            log('multi', 'æ¸…é™¤æ‰€æœ‰ç©å®¶...', 'info');
            log('multi', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š', 'info');
            log('multi', '  this.$store.dispatch("privacy/releaseSeat")', 'success');
        }

        // æµ‹è¯•5ï¼šéšç§ä¿æŠ¤éªŒè¯
        function testPrivacyProtection() {
            log('privacy', 'æµ‹è¯•éšç§ä¿æŠ¤...', 'info');
            log('privacy', '', 'info');
            log('privacy', 'æ­¥éª¤1ï¼šåˆ‡æ¢åˆ°æ— è¯´ä¹¦äººæ¨¡å¼', 'info');
            log('privacy', '  this.$store.dispatch("privacy/switchGameMode", "player-only")', 'success');
            log('privacy', '', 'info');
            log('privacy', 'æ­¥éª¤2ï¼šæ£€æŸ¥éšç§ä¿æŠ¤æ˜¯å¦å¯ç”¨', 'info');
            log('privacy', '  this.$store.state.privacy.isPrivacyEnabled', 'success');
            log('privacy', '', 'info');
            log('privacy', 'é¢„æœŸç»“æœï¼šåº”è¯¥è¿”å› true', 'success');
        }

        function testRoleVisibility() {
            log('privacy', 'æµ‹è¯•è§’è‰²å¯è§æ€§...', 'info');
            log('privacy', '', 'info');
            log('privacy', 'è¯·åœ¨ä¸»åº”ç”¨æ§åˆ¶å°ä¸­è¿è¡Œï¼š', 'info');
            log('privacy', '', 'info');
            log('privacy', 'æ£€æŸ¥æ˜¯å¦å¯ä»¥çœ‹åˆ°ç©å®¶1çš„è§’è‰²ï¼š', 'info');
            log('privacy', '  this.$store.getters["privacy/canSeeRole"]("player1")', 'success');
            log('privacy', '', 'info');
            log('privacy', 'è·å–å¯è§çš„ç©å®¶åˆ—è¡¨ï¼š', 'info');
            log('privacy', '  this.$store.getters["privacy/getVisiblePlayers"]', 'success');
        }

        // å¿«é€Ÿæ“ä½œ
        function openMainApp() {
            window.open('http://localhost:8081/', '_blank');
            log('basic', 'å·²æ‰“å¼€ä¸»åº”ç”¨', 'success');
        }

        function openConsole() {
            alert('è¯·æŒ‰ F12 æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·\nç„¶ååˆ‡æ¢åˆ° Consoleï¼ˆæ§åˆ¶å°ï¼‰æ ‡ç­¾');
        }

        function copyTestURL() {
            const url = 'http://localhost:8081/';
            navigator.clipboard.writeText(url).then(() => {
                alert('æµ‹è¯•URLå·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼š' + url);
            });
        }

        function resetAllTests() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰æµ‹è¯•ç»“æœå—ï¼Ÿ')) {
                ['basic', 'mode', 'seat', 'multi', 'privacy'].forEach(clearResult);
                alert('æ‰€æœ‰æµ‹è¯•ç»“æœå·²æ¸…é™¤');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            log('basic', 'ğŸ­ æ¬¢è¿ä½¿ç”¨æ— è¯´ä¹¦äººæ¨¡å¼æµ‹è¯•å·¥å…·ï¼', 'success');
            log('basic', '', 'info');
            log('basic', 'è¯·ç¡®ä¿å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼šnpm run serve', 'info');
            log('basic', 'ä¸»åº”ç”¨åœ°å€ï¼šhttp://localhost:8081/', 'info');
            log('basic', '', 'info');
            log('basic', 'ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'success');
        };
    </script>
</body>
</html>
