# 自动化说书人系统 - 完整测试指南

## 前置准备

### 1. 启动开发服务器
```bash
cd townsquare-develop
npm run serve
```
服务器应该在 `http://localhost:8081/` 启动

### 2. 打开浏览器
在浏览器中访问 `http://localhost:8081/`

---

## 测试流程

### 🚀 快速开始（5分钟）
1. **启动服务器**：`npm run serve`
2. **打开浏览器**：访问 `http://localhost:8081/`
3. **添加玩家**：齿轮 → 玩家 → 添加 5-7 个玩家
4. **选择版本**：齿轮 → 角色 → 选择版本（Trouble Brewing）
5. **自动分配角色**：齿轮 → 🤖 自动化说书人 → 打开控制面板 → 自动分配角色

---

### 阶段 1: 基础界面测试

#### 1.1 验证欢迎页面（中文）
- [ ] 页面显示中文欢迎信息
- [ ] 看到"血染钟楼在线魔典"标题
- [ ] 点击"进入魔典"按钮进入主界面

#### 1.2 验证菜单中文化
- [ ] 点击右上角齿轮图标打开菜单
- [ ] 验证所有标签页都是中文：
  - 📖 魔典
  - 📡 在线会话
  - 👥 玩家
  - 🎭 角色
  - 🤖 自动化说书人
  - ❓ 帮助

---

### 阶段 2: 自动化面板访问测试

#### 2.1 打开自动化面板
1. 点击右上角齿轮图标
2. 点击 🤖 **自动化说书人** 标签
3. 点击"打开控制面板"
4. **预期结果**：
   - [ ] 自动化面板从右侧滑出
   - [ ] 面板标题显示"自动化说书人控制面板"
   - [ ] 看到系统状态显示为"未启动"

#### 2.2 验证面板界面元素
- [ ] 系统状态区域显示正确
- [ ] 看到"启动系统"按钮
- [ ] 看到配置选项区域
- [ ] 看到待处理决策区域（应该为空）

---

### 阶段 3: 游戏设置测试

#### 3.1 添加玩家
1. 点击齿轮 → 👥 **玩家** 标签
2. 点击"添加 [A]"
3. 输入玩家名称（例如："玩家1"）
4. 重复添加至少 **5-7 个玩家**
5. **预期结果**：
   - [ ] 玩家出现在圆桌周围
   - [ ] 每个玩家都有名字标签

#### 3.2 选择游戏版本
1. 点击齿轮 → 🎭 **角色** 标签
2. 点击"选择版本 [E]"
3. 选择一个版本（推荐：**Trouble Brewing** 或 **Bad Moon Rising**）
4. **预期结果**：
   - [ ] 版本选择对话框关闭
   - [ ] 当前版本已更新

#### 3.3 自动分配角色（推荐方式）
1. 打开自动化面板（齿轮 → 🤖 → 打开控制面板）
2. 在"快速操作"区域，点击"自动分配角色"按钮
3. **预期结果**：
   - [ ] 系统自动为所有玩家分配角色
   - [ ] 弹出提示显示角色分配摘要：
     - 村民数量
     - 外来者数量
     - 爪牙数量
     - 恶魔数量
     - 善良/邪恶阵营人数
   - [ ] 点击玩家可以查看其角色信息
   - [ ] 角色分配符合游戏规则（正确的角色组合）

#### 3.4 手动分配角色（可选）
如果你想手动控制角色分配：
1. 点击齿轮 → 🎭 **角色** 标签
2. 点击"选择并分配 [C]"
3. 在角色选择界面中：
   - 选择适当数量的村民、外来者、爪牙、恶魔
   - 确保角色数量符合玩家人数
4. 点击确认分配
5. **预期结果**：
   - [ ] 每个玩家都被分配了角色
   - [ ] 可以点击玩家查看其角色信息

---

### 阶段 4: 自动化系统核心功能测试

#### 4.1 启动自动化系统
1. 打开自动化面板（齿轮 → 🤖 → 打开控制面板）
2. 点击"启动系统"按钮
3. **预期结果**：
   - [ ] 系统状态变为"运行中"（绿色）
   - [ ] 按钮变为"暂停系统"
   - [ ] 控制台可能显示初始化日志

#### 4.2 验证配置选项
在自动化面板中检查配置选项：
- [ ] **自动执行夜间行动** - 切换开关
- [ ] **自动处理投票** - 切换开关
- [ ] **AI 决策模式** - 下拉选择（保守/平衡/激进）
- [ ] **显示决策日志** - 切换开关
- [ ] 每个选项都能正常切换

#### 4.3 测试夜间行动处理
1. 确保系统正在运行
2. 点击齿轮 → 📖 **魔典** 标签
3. 点击"切换到夜晚 [S]"
4. **预期结果**：
   - [ ] 界面切换到夜间模式（背景变暗）
   - [ ] 如果启用了"自动执行夜间行动"：
     - 自动化面板显示正在处理的行动
     - 待处理决策区域可能显示需要决策的项目
   - [ ] 决策日志显示处理过程

#### 4.4 测试角色能力执行
1. 在夜间模式下
2. 点击某个有夜间能力的角色（例如：占卜师、毒师）
3. 观察自动化面板
4. **预期结果**：
   - [ ] 系统识别该角色的能力
   - [ ] 如果需要决策，显示在待处理决策区域
   - [ ] 可以手动批准或拒绝决策
   - [ ] 决策执行后，游戏状态更新

#### 4.5 测试白天投票
1. 点击"切换到白天 [S]"
2. 点击一个玩家发起提名
3. 进行投票
4. **预期结果**：
   - [ ] 如果启用"自动处理投票"，系统自动统计票数
   - [ ] 投票结果显示在界面上
   - [ ] 投票历史记录更新
   - [ ] 自动化面板显示投票处理日志

---

### 阶段 5: AI 决策引擎测试

#### 5.1 测试 AI 决策模式
1. 在自动化面板中切换 AI 决策模式：
   - **保守模式**：测试一轮游戏
   - **平衡模式**：测试一轮游戏
   - **激进模式**：测试一轮游戏
2. **预期结果**：
   - [ ] 不同模式下，AI 的决策策略有明显差异
   - [ ] 保守模式：更谨慎，较少使用强力能力
   - [ ] 激进模式：更主动，积极使用能力

#### 5.2 测试待处理决策
1. 确保有需要决策的情况（例如：毒师选择目标）
2. 在待处理决策区域查看决策项
3. **预期结果**：
   - [ ] 显示决策描述（例如："毒师需要选择毒杀目标"）
   - [ ] 显示 AI 推荐的选项
   - [ ] 可以点击"批准"或"拒绝"
   - [ ] 批准后决策立即执行

---

### 阶段 6: 状态同步测试

#### 6.1 测试游戏状态更新
1. 执行各种游戏操作：
   - 添加/移除玩家
   - 改变玩家状态（存活/死亡）
   - 添加提醒标记
2. 观察自动化面板
3. **预期结果**：
   - [ ] 自动化系统实时反映游戏状态变化
   - [ ] 决策日志记录所有状态变更
   - [ ] 系统状态保持"运行中"

#### 6.2 测试暂停/恢复
1. 点击"暂停系统"
2. 执行一些游戏操作
3. 点击"恢复系统"
4. **预期结果**：
   - [ ] 暂停时系统状态显示"已暂停"（橙色）
   - [ ] 暂停期间不自动处理行动
   - [ ] 恢复后系统继续正常工作

---

### 阶段 7: 胜负判断测试

#### 7.1 测试胜利条件检测
1. 模拟游戏结束场景：
   - **善良阵营胜利**：杀死所有恶魔
   - **邪恶阵营胜利**：只剩 2 名存活玩家
2. **预期结果**：
   - [ ] 系统自动检测胜利条件
   - [ ] 显示胜利提示
   - [ ] 决策日志记录胜利判断

---

### 阶段 8: 错误处理测试

#### 8.1 测试异常情况
1. 尝试在没有玩家时启动系统
2. 尝试在没有角色时执行夜间行动
3. 快速切换白天/夜晚
4. **预期结果**：
   - [ ] 系统显示适当的错误消息
   - [ ] 不会崩溃或卡死
   - [ ] 错误信息显示在决策日志中

#### 8.2 测试停止系统
1. 点击"停止系统"
2. **预期结果**：
   - [ ] 系统状态变为"未启动"
   - [ ] 所有自动化功能停止
   - [ ] 可以重新启动系统

---

### 阶段 9: 完整游戏流程测试

#### 9.1 完整游戏测试
执行一个完整的游戏流程：

1. **准备阶段**
   - [ ] 添加 7 名玩家
   - [ ] 选择 Trouble Brewing 版本
   - [ ] 分配角色

2. **启动自动化**
   - [ ] 打开自动化面板
   - [ ] 启动系统
   - [ ] 启用所有自动化选项

3. **第一夜**
   - [ ] 切换到夜晚
   - [ ] 观察系统自动处理首夜信息
   - [ ] 验证所有夜间能力按顺序执行

4. **第一天**
   - [ ] 切换到白天
   - [ ] 进行讨论和提名
   - [ ] 执行投票
   - [ ] 验证投票自动处理

5. **后续夜晚**
   - [ ] 切换到夜晚
   - [ ] 观察夜间行动自动执行
   - [ ] 检查死亡玩家处理

6. **游戏结束**
   - [ ] 继续游戏直到满足胜利条件
   - [ ] 验证胜负判断正确

---

## 性能测试

### 10.1 压力测试
- [ ] 添加最大数量玩家（20 人）
- [ ] 快速切换白天/夜晚多次
- [ ] 系统保持稳定，无明显延迟

### 10.2 长时间运行测试
- [ ] 运行系统 10+ 个游戏回合
- [ ] 检查内存使用是否稳定
- [ ] 验证没有内存泄漏

---

## 浏览器控制台检查

### 11.1 检查控制台日志
1. 按 F12 打开开发者工具
2. 查看 Console 标签
3. **预期结果**：
   - [ ] 没有红色错误信息
   - [ ] 可能有蓝色/灰色的信息日志
   - [ ] 自动化系统的调试日志清晰可读

### 11.2 检查 Vuex 状态
1. 在控制台输入：`$vm0.$store.state.automation`
2. **预期结果**：
   - [ ] 显示完整的自动化状态对象
   - [ ] `isAutomationEnabled` 反映当前状态
   - [ ] `systemStatus` 正确
   - [ ] `pendingDecisions` 数组存在

---

## 测试检查清单总结

### 核心功能
- [ ] ✅ 自动化面板可以打开和关闭
- [ ] ✅ 系统可以启动、暂停、停止
- [ ] ✅ 配置选项可以正常切换
- [ ] ✅ 夜间行动自动处理
- [ ] ✅ 投票自动处理
- [ ] ✅ AI 决策引擎工作正常
- [ ] ✅ 待处理决策显示和处理
- [ ] ✅ 胜负条件自动判断
- [ ] ✅ 状态同步正常
- [ ] ✅ 错误处理正确

### 界面
- [ ] ✅ 所有文本都是中文
- [ ] ✅ 界面响应流畅
- [ ] ✅ 没有布局错误
- [ ] ✅ 图标显示正确

### 稳定性
- [ ] ✅ 没有崩溃
- [ ] ✅ 没有控制台错误
- [ ] ✅ 长时间运行稳定
- [ ] ✅ 异常情况处理正确

---

## 常见问题排查

### 问题 1: 自动化面板打不开
- 检查控制台是否有错误
- 确认 `AutomationPanel.vue` 已正确导入
- 检查 Vuex store 中的 automation 模块

### 问题 2: 系统启动后没有反应
- 确认已添加玩家并分配角色
- 检查配置选项是否正确启用
- 查看决策日志是否有错误信息

### 问题 3: 夜间行动不自动执行
- 确认"自动执行夜间行动"选项已启用
- 检查是否有待处理决策需要手动批准
- 验证角色能力定义是否正确

### 问题 4: 投票不自动处理
- 确认"自动处理投票"选项已启用
- 检查投票是否已完成（所有玩家都投票）
- 查看决策日志了解处理状态

---

## 测试完成标准

当以上所有测试项都通过时，自动化说书人系统即可认为功能完整且稳定。

**预计测试时间**：30-60 分钟（完整测试）

**建议测试环境**：
- Chrome 或 Firefox 最新版本
- 屏幕分辨率 1920x1080 或更高
- 开启浏览器开发者工具以监控日志

---

## 下一步

测试完成后，可以：
1. 记录发现的任何问题
2. 提出功能改进建议
3. 开始实际游戏使用
4. 邀请其他玩家测试多人在线功能

祝测试顺利！🎉
