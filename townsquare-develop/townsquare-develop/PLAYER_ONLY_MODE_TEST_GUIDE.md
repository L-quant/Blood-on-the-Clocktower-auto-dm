# 无说书人模式测试指南

## 单人本地测试方案

即使只有一个玩家，你也可以测试大部分功能。以下是测试步骤：

## 测试环境准备

### 方法1：使用多个浏览器标签页（推荐）
1. 打开多个浏览器标签页，每个标签页代表一个玩家
2. 或者使用不同的浏览器（Chrome、Firefox、Edge等）
3. 或者使用浏览器的隐私/无痕模式打开多个窗口

### 方法2：使用多个设备
1. 在电脑上打开 http://localhost:8081/
2. 在手机上打开 http://[你的电脑IP]:8081/
3. 确保设备在同一局域网内

## 核心功能测试清单

### 1. 游戏模式选择测试 ✓
**目标**：验证可以选择不同的游戏模式

**步骤**：
1. 打开应用 http://localhost:8081/
2. 点击右上角齿轮图标打开菜单
3. 切换到"会话"标签（广播塔图标）
4. 点击"选择游戏模式"
5. 应该看到两个选项：
   - 说书人模式（默认）
   - 无说书人模式
6. 选择"无说书人模式"
7. 点击"确认选择"
8. 检查是否成功切换（打开浏览器控制台查看日志）

**预期结果**：
- Modal正确显示
- 可以选择模式
- 点击确认后Modal关闭
- 控制台显示：`[Privacy] Switched to player-only mode`

---

### 2. 隐私保护系统测试
**目标**：验证在无说书人模式下，角色信息被正确隐藏

**单人测试步骤**：
1. 选择"无说书人模式"
2. 添加几个玩家（点击菜单 -> 玩家 -> 添加）
3. 选择版本和角色（菜单 -> 角色）
4. 分配角色
5. 观察：所有玩家的角色应该显示为"?"或隐藏状态

**多标签页测试步骤**：
1. 标签页A：作为主机，选择"无说书人模式"
2. 标签页A：点击"主持（说书人）"，创建会话
3. 标签页A：添加3-5个玩家
4. 标签页B、C、D：打开新标签页，点击"加入（玩家）"，输入会话ID
5. 每个标签页应该只能看到自己的角色

**预期结果**：
- 在无说书人模式下，未认领的角色显示为隐藏
- 每个玩家只能看到自己的角色
- 其他玩家的角色显示为"?"

---

### 3. 座位认领测试
**目标**：验证玩家可以认领座位并获得角色信息

**测试步骤**：
1. 打开多个浏览器标签页
2. 标签页A：创建会话，添加玩家，分配角色
3. 标签页B：加入会话
4. 标签页B：应该看到座位选择界面
5. 标签页B：选择一个座位并认领
6. 标签页B：应该只能看到自己的角色

**预期结果**：
- 玩家可以选择并认领座位
- 认领后获得唯一令牌
- 只能看到自己的角色信息
- 其他玩家的角色仍然隐藏

---

### 4. 自动化说书人集成测试
**目标**：验证自动化系统在无说书人模式下正常工作

**测试步骤**：
1. 选择"无说书人模式"
2. 添加玩家并分配角色
3. 打开自动化控制面板（菜单 -> 自动化说书人）
4. 启动自动化系统
5. 观察游戏流程是否自动进行

**预期结果**：
- 自动化系统正常启动
- 夜间行动自动处理
- 每个玩家只收到自己的信息
- 投票系统正常工作

---

### 5. 模式切换限制测试
**目标**：验证游戏开始后无法切换模式

**测试步骤**：
1. 选择任意模式
2. 添加玩家并启动游戏
3. 尝试打开"选择游戏模式"
4. 应该看到警告信息

**预期结果**：
- 游戏开始后，模式选择器显示警告
- 无法切换模式
- 控制台显示：`[Privacy] Cannot switch mode while game is running`

---

## 快速验证脚本

打开浏览器控制台（F12），运行以下代码来验证核心功能：

```javascript
// 1. 检查privacy模块是否正确加载
console.log('Privacy module:', this.$store.state.privacy);

// 2. 检查当前游戏模式
console.log('Current mode:', this.$store.state.privacy.gameMode);

// 3. 测试切换到无说书人模式
this.$store.dispatch('privacy/switchGameMode', 'player-only')
  .then(result => console.log('Switch result:', result));

// 4. 检查隐私保护是否启用
console.log('Privacy enabled:', this.$store.state.privacy.isPrivacyEnabled);

// 5. 测试座位认领
this.$store.dispatch('privacy/claimSeat', { playerId: 'test-player-1', seatIndex: 0 })
  .then(result => console.log('Claim seat result:', result));

// 6. 检查可用座位
console.log('Available seats:', this.$store.getters['privacy/availableSeats']);
```

---

## 模拟多玩家测试（使用浏览器开发工具）

如果你想在单个浏览器中模拟多个玩家：

### 步骤1：打开多个标签页
```
标签页1: http://localhost:8081/
标签页2: http://localhost:8081/
标签页3: http://localhost:8081/
```

### 步骤2：在标签页1（主机）
1. 点击菜单 -> 会话 -> 主持（说书人）
2. 输入会话ID（例如：1234）
3. 选择"无说书人模式"
4. 添加3个玩家：Alice, Bob, Charlie
5. 选择版本（例如：Trouble Brewing）
6. 分配角色

### 步骤3：在标签页2（玩家Alice）
1. 点击菜单 -> 会话 -> 加入（玩家）
2. 输入会话ID：1234
3. 应该看到游戏界面
4. 选择座位（Alice的位置）
5. 只能看到Alice的角色

### 步骤4：在标签页3（玩家Bob）
1. 重复标签页2的步骤
2. 选择Bob的座位
3. 只能看到Bob的角色

---

## 检查点清单

完成以下检查点，确认功能正常：

- [ ] ✓ ModeSelector组件正确显示
- [ ] ✓ 可以选择"无说书人模式"
- [ ] ✓ 点击"确认选择"后Modal关闭
- [ ] ✓ 游戏模式正确切换（检查store状态）
- [ ] ✓ 在无说书人模式下，角色信息被隐藏
- [ ] ✓ 玩家可以认领座位
- [ ] ✓ 认领座位后获得令牌
- [ ] ✓ 只能看到自己的角色
- [ ] ✓ 游戏开始后无法切换模式
- [ ] ✓ 自动化系统在无说书人模式下正常工作
- [ ] ✓ 断线重连功能正常（使用令牌恢复会话）

---

## 调试技巧

### 查看Store状态
打开Vue DevTools（浏览器扩展），查看Vuex状态：
- `state.privacy.gameMode` - 当前游戏模式
- `state.privacy.isPrivacyEnabled` - 隐私保护是否启用
- `state.privacy.myPlayerId` - 当前玩家ID
- `state.privacy.mySeatIndex` - 当前座位索引
- `state.privacy.myToken` - 认证令牌

### 查看控制台日志
所有隐私相关操作都会在控制台输出日志，前缀为`[Privacy]`：
```
[Privacy] Switched to player-only mode
[Privacy] Successfully claimed seat 0
[Privacy] Reconnection successful
```

### 查看网络请求
打开浏览器开发工具 -> Network标签，查看WebSocket连接：
- 应该看到`ws://localhost:8081/`连接
- 查看消息内容，确认角色信息被正确过滤

---

## 已知限制

当前实现的限制：
1. 需要WebSocket服务器支持（已在server/index.js中实现）
2. 座位认领UI尚未完全实现（需要在Player.vue中添加）
3. 断线重连UI尚未完全实现
4. 游戏结束时的角色公开功能需要进一步测试

---

## 下一步

如果基本功能测试通过，可以进行以下增强：
1. 完善座位认领UI
2. 添加断线重连提示
3. 实现游戏结束时的角色公开动画
4. 添加更多的错误处理和用户提示
5. 编写自动化测试用例

---

## 问题排查

如果遇到问题，请检查：
1. 浏览器控制台是否有错误信息
2. Vue DevTools中的Vuex状态是否正确
3. 网络连接是否正常（WebSocket）
4. 服务器日志是否有错误
5. 是否正确安装了所有依赖

如有问题，请查看控制台日志并提供错误信息。
